#include <iostream>

#include "keybinds.h"

using std::map, std::string, std::cin, std::cout, std::endl;

KeybindsModule::KeybindsModule(CommandsModule& commandsModule)
	:commandsModule(commandsModule)
{
	CommandArgType* bindArgs = new CommandArgType[2];
	bindArgs[0] = STR;
	bindArgs[1] = STR_REST;
	commandsModule.addCommand({"bind", Keybindbind, 2, bindArgs});
	commandsModule.addCommand({"exit", exit, 0, {}});
	commandsModule.addCommand({"readBinds", readBinds, 0, {}});
}

const void KeybindsModule::bind(const CommandArg* argv)
{
	Err e = commandsModule.checkCommand(argv[1].str);
	if(e.code != NOERR)
	{
		e.message = "Binding fail - " + e.message;
		throw e;
	}
	binds.insert({argv[0].str, argv[1].str});
}
const void KeybindsModule::readBinds(const CommandArg* argv)
{
	cout << "Reading binds" << endl;
	while(exitNow == false)
	{
		string key;
		std::getline(std::cin, key);
		commandsModule.runCommand(binds.find(key)->second);
	}
}

const void KeybindsModule::exit(const CommandArg* argv)
{
	exitNow = false;
}
